"use strict";(self.webpackChunkdesktop=self.webpackChunkdesktop||[]).push([[311],{38311:(F,d,n)=>{n.r(d),n.d(d,{MessagesModule:()=>c});var p=n(55028),m=n(13313),h=n(7226),f=n(66239),u=n(8929),v=n(86377),M=n(87034),e=n(94650),l=n(34793),g=n(36895),L=n(78387),x=n(32925),T=n(10590),Z=n(12977);function I(t,a){1&t&&(e.TgZ(0,"div",10),e._UZ(1,"div",11),e.qZA())}function A(t,a){if(1&t&&(e._UZ(0,"h5",20),e.ALo(1,"stripHtml")),2&t){const s=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,s.subject),e.oJD)}}function D(t,a){if(1&t&&(e._UZ(0,"p",21),e.ALo(1,"stripHtml")),2&t){const s=e.oxw().$implicit;e.Q6J("innerHTML",e.lcZ(1,1,s.body),e.oJD)}}const C=function(t,a){return{actived:t,unread:a}};function _(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"div",14)(1,"a",15),e.NdJ("click",function(r){const $=e.CHM(s).$implicit,j=e.oxw(2);return e.KtG(j.markAsDelete($.customerMessageId,r))}),e._UZ(2,"i",16),e.qZA(),e.YNc(3,A,2,3,"h5",17),e.YNc(4,D,2,3,"p",18),e.TgZ(5,"div",19),e._uU(6),e.ALo(7,"date"),e.qZA()()}if(2&t){const s=a.$implicit,i=e.oxw(2);e.Q6J("ngClass",e.WLB(7,C,s.customerMessageId===i.selectedMessage.customerMessageId,!s.read))("routerLink","/"+i.currentLang+"/messages/"+s.customerMessageId),e.xp6(3),e.Q6J("ngIf",s.subject),e.xp6(1),e.Q6J("ngIf",s.body),e.xp6(2),e.hij(" ",e.lcZ(7,5,s.sendDate)," ")}}function J(t,a){if(1&t&&(e.TgZ(0,"div",12),e.YNc(1,_,8,10,"div",13),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.Q6J("ngForOf",s.messageList)}}function y(t,a){if(1&t&&(e._UZ(0,"h5",25),e.ALo(1,"safeHtml")),2&t){const s=e.oxw(3);e.Q6J("innerHTML",e.lcZ(1,1,s.selectedMessage.subject),e.oJD)}}function S(t,a){if(1&t&&(e._UZ(0,"p",25),e.ALo(1,"safeHtml")),2&t){const s=e.oxw(3);e.Q6J("innerHTML",e.lcZ(1,1,s.selectedMessage.body),e.oJD)}}function H(t,a){if(1&t&&(e.TgZ(0,"div"),e.YNc(1,y,2,3,"h5",24),e.YNc(2,S,2,3,"p",24),e.TgZ(3,"div",19),e._uU(4),e.ALo(5,"date"),e.qZA()()),2&t){const s=e.oxw(2);e.xp6(1),e.Q6J("ngIf",s.selectedMessage.subject),e.xp6(1),e.Q6J("ngIf",s.selectedMessage.body),e.xp6(2),e.hij(" ",e.lcZ(5,3,s.selectedMessage.sendDate)," ")}}function Q(t,a){if(1&t&&(e.TgZ(0,"div",22),e.YNc(1,H,6,5,"div",23),e.qZA()),2&t){const s=e.oxw();e.xp6(1),e.Q6J("ngIf",!!s.selectedMessage)}}function N(t,a){1&t&&(e.TgZ(0,"div",26),e._UZ(1,"message-box",27),e.ALo(2,"translate"),e.qZA()),2&t&&(e.xp6(1),e.s9C("content",e.lcZ(2,1,"MESSAGES.CUSTOMER_MESSAGE_NOT_FOUND")))}h.N.map.messageDetail;class o{constructor(a,s,i,r){this.messagesService=a,this.route=s,this.translateFactory=i,this.router=r,this.messageList=[],this.inProgress=!0,this.destroyed$=new u.xQ}ngOnInit(){this.currentLang=this.translateFactory.currentLang.code,this.getMessages()}getMessages(){this.messagesService.getMessages().then(a=>{if(this.inProgress=!1,this.messageList=(0,v.Z)(a,"sendDate","desc"),this.route.params.pipe((0,f.Rs)(this.destroyed$)).subscribe(i=>{this.messageList&&this.messageList.length&&i.msgId&&this.setSelectedMessage(i.msgId)}),this.route.snapshot.paramMap.get("msgId"))return!1;this.router.navigate(["/",this.currentLang,"messages",this.messageList[0].customerMessageId])}).catch(a=>{this.inProgress=!1})}markAsRead(a){this.messagesService.markAsRead(a).then(s=>{})}markAsDelete(a,s){s.preventDefault(),this.messagesService.markAsDelete(a).then(i=>{(0,M.Z)(this.messageList,r=>r.customerMessageId===a)})}setSelectedMessage(a){let s=this.messageList.find(i=>i.customerMessageId===Number(a));s||(s=this.messageList[0]),this.selectedMessage=s,this.selectedMessage&&!this.selectedMessage.read&&(s.read=!0,setTimeout(i=>{this.markAsRead(this.selectedMessage.customerMessageId)},200))}ngOnDestroy(){this.destroyed$.next(!0),this.destroyed$.complete()}}o.\u0275fac=function(a){return new(a||o)(e.Y36(m.Ry4),e.Y36(l.gz),e.Y36(m.chr),e.Y36(l.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["messages"]],decls:12,vars:7,consts:[[1,"message-detail","container"],[1,"row"],[1,"modul-accordion"],[1,"modul-header"],[1,"header-text"],[1,"modul-content"],["class","progress",4,"ngIf"],["class","col s3 message-left",4,"ngIf"],["class","col s9 message-right",4,"ngIf"],["class","col s12",4,"ngIf"],[1,"progress"],[1,"indeterminate"],[1,"col","s3","message-left"],["class","message",3,"ngClass","routerLink",4,"ngFor","ngForOf"],[1,"message",3,"ngClass","routerLink"],["href","javascript:;",3,"click"],[1,"fa","fa-times","right"],["class","truncate",3,"innerHTML",4,"ngIf"],["class","msg-cont truncate",3,"innerHTML",4,"ngIf"],[1,"message-date"],[1,"truncate",3,"innerHTML"],[1,"msg-cont","truncate",3,"innerHTML"],[1,"col","s9","message-right"],[4,"ngIf"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],[1,"col","s12"],["type","error","icon","fa fa-exclamation-circle",3,"content"]],template:function(a,s){1&a&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"div",5),e.YNc(8,I,2,0,"div",6),e.YNc(9,J,2,1,"div",7),e.YNc(10,Q,2,1,"div",8),e.YNc(11,N,3,3,"div",9),e.qZA()()()()),2&a&&(e.xp6(5),e.hij(" ",e.lcZ(6,5,"TEXTS.MESSAGES")," "),e.xp6(3),e.Q6J("ngIf",s.inProgress),e.xp6(1),e.Q6J("ngIf",!!s.messageList&&s.messageList.length),e.xp6(1),e.Q6J("ngIf",!!s.messageList&&s.messageList.length),e.xp6(1),e.Q6J("ngIf",!s.inProgress&&!!s.messageList&&!s.messageList.length))},dependencies:[l.rH,g.mk,g.sg,g.O5,L.W,x.X$,g.uU,T.p,Z.z],encapsulation:2});const U=[{path:"",pathMatch:"full",canActivate:[m.$Tg],component:o,data:{name:"messages"}},{path:"",canActivate:[m.$Tg],children:[{path:":msgId",component:o,data:{name:"message-detail"}}]}],Y=l.Bz.forChild(U);class c{}c.\u0275fac=function(a){return new(a||c)},c.\u0275mod=e.oAB({type:c}),c.\u0275inj=e.cJS({providers:[g.uU],imports:[Y,p.m]})}}]);