import{S as A,d as Z,a as T,o as b,c as m,i as h,O as _,b as G,r as K,e as D,f as H,g as J,h as N,j as Q,k as $,l as X,m as P,n as j}from"./innerFrom.75f1cdf8.js";import{k as Y,l as z,c as L,u as V,b as q,B}from"./index.36a91d4c.js";import{d as nn}from"./loadHelpers.abbaab45.js";import{_ as en,a as tn,b as rn,c as on,d as E}from"./tslib.es6.b90ee611.js";var an=function(n){en(t,n);function t(r,e,i){r===void 0&&(r=1/0),e===void 0&&(e=1/0),i===void 0&&(i=Z);var o=n.call(this)||this;return o._bufferSize=r,o._windowTime=e,o._timestampProvider=i,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=e===1/0,o._bufferSize=Math.max(1,r),o._windowTime=Math.max(1,e),o}return t.prototype.next=function(r){var e=this,i=e.isStopped,o=e._buffer,u=e._infiniteTimeWindow,a=e._timestampProvider,f=e._windowTime;i||(o.push(r),!u&&o.push(a.now()+f)),this._trimBuffer(),n.prototype.next.call(this,r)},t.prototype._subscribe=function(r){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(r),i=this,o=i._infiniteTimeWindow,u=i._buffer,a=u.slice(),f=0;f<a.length&&!r.closed;f+=o?1:2)r.next(a[f]);return this._checkFinalizedStatuses(r),e},t.prototype._trimBuffer=function(){var r=this,e=r._bufferSize,i=r._timestampProvider,o=r._buffer,u=r._infiniteTimeWindow,a=(u?1:2)*e;if(e<1/0&&a<o.length&&o.splice(0,o.length-a),!u){for(var f=i.now(),s=0,c=1;c<o.length&&o[c]<=f;c+=2)s=c;s&&o.splice(0,s+1)}},t}(A);function un(n){return n&&T(n.schedule)}function k(n){return n[n.length-1]}function Cn(n){return un(k(n))?n.pop():void 0}function In(n,t){return typeof k(n)=="number"?n.pop():t}function v(n,t,r,e,i){e===void 0&&(e=0),i===void 0&&(i=!1);var o=t.schedule(function(){r(),i?n.add(this.schedule(null,e)):this.unsubscribe()},e);if(n.add(o),!i)return o}function F(n,t){return t===void 0&&(t=0),b(function(r,e){r.subscribe(m(e,function(i){return v(e,n,function(){return e.next(i)},t)},function(){return v(e,n,function(){return e.complete()},t)},function(i){return v(e,n,function(){return e.error(i)},t)}))})}function W(n,t){return t===void 0&&(t=0),b(function(r,e){e.add(n.schedule(function(){return r.subscribe(e)},t))})}function fn(n,t){return h(n).pipe(W(t),F(t))}function sn(n,t){return h(n).pipe(W(t),F(t))}function cn(n,t){return new _(function(r){var e=0;return t.schedule(function(){e===n.length?r.complete():(r.next(n[e++]),r.closed||this.schedule())})})}function ln(n,t){return new _(function(r){var e;return v(r,t,function(){e=n[G](),v(r,t,function(){var i,o,u;try{i=e.next(),o=i.value,u=i.done}catch(a){r.error(a);return}u?r.complete():r.next(o)},0,!0)}),function(){return T(e==null?void 0:e.return)&&e.return()}})}function M(n,t){if(!n)throw new Error("Iterable cannot be null");return new _(function(r){v(r,t,function(){var e=n[Symbol.asyncIterator]();v(r,t,function(){e.next().then(function(i){i.done?r.complete():r.next(i.value)})},0,!0)})})}function dn(n,t){return M(K(n),t)}function vn(n,t){if(n!=null){if(D(n))return fn(n,t);if(H(n))return cn(n,t);if(J(n))return sn(n,t);if(N(n))return M(n,t);if(Q(n))return ln(n,t);if($(n))return dn(n,t)}throw X(n)}function Sn(n,t){return t?vn(n,t):h(n)}function gn(n,t){return b(function(r,e){var i=0;r.subscribe(m(e,function(o){return n.call(t,o,i++)&&e.next(o)}))})}function On(n,t){return t===void 0&&(t=P),n=n??mn,b(function(r,e){var i,o=!0;r.subscribe(m(e,function(u){var a=t(u);(o||!n(i,a))&&(o=!1,i=a,e.next(u))}))})}function mn(n,t){return n===t}function bn(n){n===void 0&&(n={});var t=n.connector,r=t===void 0?function(){return new A}:t,e=n.resetOnError,i=e===void 0?!0:e,o=n.resetOnComplete,u=o===void 0?!0:o,a=n.resetOnRefCountZero,f=a===void 0?!0:a;return function(s){var c,l,d,x=0,w=!1,y=!1,C=function(){l==null||l.unsubscribe(),l=void 0},g=function(){C(),c=d=void 0,w=y=!1},U=function(){var p=c;g(),p==null||p.unsubscribe()};return b(function(p,R){x++,!y&&!w&&C();var I=d=d??r();R.add(function(){x--,x===0&&!y&&!w&&(l=O(U,f))}),I.subscribe(R),!c&&x>0&&(c=new j({next:function(S){return I.next(S)},error:function(S){y=!0,C(),l=O(g,i,S),I.error(S)},complete:function(){w=!0,C(),l=O(g,u),I.complete()}}),h(p).subscribe(c))})(s)}}function O(n,t){for(var r=[],e=2;e<arguments.length;e++)r[e-2]=arguments[e];if(t===!0){n();return}if(t!==!1){var i=new j({next:function(){i.unsubscribe(),n()}});return h(t.apply(void 0,tn([],rn(r)))).subscribe(i)}}function hn(n,t,r){var e,i,o,u,a=!1;return n&&typeof n=="object"?(e=n.bufferSize,u=e===void 0?1/0:e,i=n.windowTime,t=i===void 0?1/0:i,o=n.refCount,a=o===void 0?!1:o,r=n.scheduler):u=n??1/0,bn({connector:function(){return new an(u,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function Tn(n,t){return b(function(r,e){var i=null,o=0,u=!1,a=function(){return u&&!i&&e.complete()};r.subscribe(m(e,function(f){i==null||i.unsubscribe();var s=0,c=o++;h(n(f,c)).subscribe(i=m(e,function(l){return e.next(t?t(f,l,c,s++):l)},function(){i=null,a()}))},function(){u=!0,a()}))})}function Rn(n,t,r){var e=T(n)||t||r?{next:n,error:t,complete:r}:n;return e?b(function(i,o){var u;(u=e.subscribe)===null||u===void 0||u.call(e);var a=!0;i.subscribe(m(o,function(f){var s;(s=e.next)===null||s===void 0||s.call(e,f),o.next(f)},function(){var f;a=!1,(f=e.complete)===null||f===void 0||f.call(e),o.complete()},function(f){var s;a=!1,(s=e.error)===null||s===void 0||s.call(e,f),o.error(f)},function(){var f,s;a&&((f=e.unsubscribe)===null||f===void 0||f.call(e)),(s=e.finalize)===null||s===void 0||s.call(e)}))}):P}function pn(n,t){t===void 0&&(t={});var r=t.selector,e=on(t,["selector"]);return new _(function(i){var o=new AbortController,u=o.signal,a=!0,f=e.signal;if(f)if(f.aborted)o.abort();else{var s=function(){u.aborted||o.abort()};f.addEventListener("abort",s),i.add(function(){return f.removeEventListener("abort",s)})}var c=E(E({},e),{signal:u}),l=function(d){a=!1,i.error(d)};return fetch(n,c).then(function(d){r?h(r(d)).subscribe(m(i,void 0,function(){a=!1,i.complete()},l)):(a=!1,i.next(d),i.complete())}).catch(l),function(){a&&o.abort()}})}function En(n){return{subscribe:t=>{const r=n.subscribe(t);return()=>{r.unsubscribe()}}}}function An({doc:n,variables:t}){const r=new Headers(nn),e=Y(),i=z();return e&&r.set("x-access-token",e),i&&r.set("x-language",i),pn(V,{method:"POST",headers:r,body:JSON.stringify({query:L(n),variables:t}),selector:o=>o.json()})}function Pn({query:n,variables:t}){return new _(r=>{const e=q.subscribe({query:L(n),variables:t},{error:i=>{r.error(i)},complete:()=>r.complete(),next:i=>{var o,u,a;if(r.next(i.data),i.errors&&B){const f=(a=(u=(o=n==null?void 0:n.definitions)==null?void 0:o[0])==null?void 0:u.name)==null?void 0:a.value;console.error(f,"next subscription error",t,i.errors)}}});return()=>{e()}})}function jn(n){return n.pipe(hn({bufferSize:1,refCount:!0}))}function Ln(n,t,r){return(e,i)=>{const o=r(e),u=n.get(o);if(u)return u;const a=t(e,i);return n.set(o,a),a}}export{gn as a,An as b,In as c,On as d,v as e,Sn as f,Ln as g,Pn as h,un as i,En as o,Cn as p,jn as r,Tn as s,Rn as t};
