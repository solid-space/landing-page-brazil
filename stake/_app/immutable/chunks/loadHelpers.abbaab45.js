import{x as m,l as I,k as M,u as y,c as S,B as A,e as O}from"./index.36a91d4c.js";import{d as x}from"./index.922d4a37.js";import{w as E}from"./index.d67a6375.js";import{o as L,G as _}from"./index.03b5aaf0.js";import{i as D}from"./navigation.1c24ec45.js";import{c as N}from"./index.b135e261.js";const C=Object.fromEntries([x,["Content-Type","application/json"],["Access-Control-Allow-Origin","*"]].filter(Boolean)),G=1e4,v=new Map;async function P(e){return e!=null&&e.parent?e.parent():(console.error("getParent",e,e.parent),null)}async function b(e){const t=await P(e);return(e.data&&"session"in e.data?e.data.session:void 0)??(t&&"session"in t?t==null?void 0:t.session:void 0)}const R=async(e,t)=>{var a;try{if(m){const s=I()||((a=await b(e))==null?void 0:a.locale)||N.DEFAULT_LANGUAGE;return{session:M(),locale:s}}const o=await b(e);if(!o)throw console.error("failed to load session",t),new Error("failed to load session "+t);return o}catch(o){return console.error(o),{session:null,locale:"en"}}};async function B({load:e,doc:t,variables:a,cache:o}){var i,r,n;const s=(n=(r=(i=t==null?void 0:t.definitions)==null?void 0:i[0])==null?void 0:r.name)==null?void 0:n.value;try{const f=new AbortController,h=setTimeout(()=>{},G);try{const l=new Headers(C),c=await R(e,s);c!=null&&c.session&&l.set("x-access-token",c.session),c!=null&&c.locale&&l.set("x-language",c.locale);const d=m&&o?o.name+JSON.stringify(a):null;if(d&&v.has(d))return v.get(d);const g=await e.fetch(y,{method:"POST",headers:l,body:JSON.stringify({query:S(t),variables:a}),signal:f.signal});if(g.status===200){const u=await g.json(),w=(u==null?void 0:u.errors)||[],T=u==null?void 0:u.data;return w.length!==0?(A||(console.error("api load error",g.status,y,w),console.error("api load error query: ",S(t)),console.error("api load error variables: ",a)),w.forEach(p=>{O.next({type:(p==null?void 0:p.errorType)||"errorExchange",error:p})})):m&&d&&v.set(d,T),T??void 0}A||console.error("bad response",y,g.status,s,g);return}catch(l){console.error("load error",y,s,l);return}finally{clearTimeout(h)}}catch(f){console.error(f);return}}function V(e,t){return B({load:{fetch},doc:e,variables:t})}function Q(e){const t=E(!1),a=async()=>{t.set(!0);try{await D(e)}finally{t.set(!1)}};return{namespace:e,refetch:a,loading:t,refetchEvery:o=>{L(()=>{const s=setInterval(()=>{t.set(!0),a()},o);return()=>{clearInterval(s)}})}}}function W({data:e,query:t,normalize:a}){const o=E({data:e,loading:!1,error:null}),s=i=>{o.update(r=>({...r,loading:i}))};return{...o,loadMore:async()=>{s(!0);const i=_(o);try{const r=await t(i.data);r&&o.update(n=>({...n,...r,data:n.data?a(n.data,r):r}))}catch(r){o.update(n=>({...n,loading:!1,error:r}))}finally{s(!1)}}}}function X({data:e,query:t}){const a=E({data:e,loading:!1,error:null}),o=i=>{a.update(r=>({...r,loading:i}))},s=async i=>{o(!0);try{const r=await t(i);r&&a.update(n=>({...n,...r,lastFetchedAt:Date.now(),data:r}))}catch(r){a.update(n=>({...n,loading:!1,error:r}))}finally{o(!1)}};return{...a,refetch:s,refetchEvery:(i,r)=>{L(()=>{let n;const f=a.subscribe(h=>{h.loading===!1&&(clearTimeout(n),n=setTimeout(()=>{_(a).loading===!1&&s(r())},i))});return()=>{clearTimeout(n),f()}})}}}export{Q as c,C as d,B as f,R as g,W as l,V as m,X as r};
