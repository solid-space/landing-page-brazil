import{_ as m}from"./lodash.9552c526.js";import{w as d,d as L}from"./index.d67a6375.js";import{R as _}from"./RacePosition.generated.bc1f407e.js";import{U as V}from"./UserTags.generated.1a569433.js";import{t as M,o as F,r as j,p as A,N as E}from"./index.36a91d4c.js";import{L as x,S as B}from"./index.38950c17.js";import{M as q}from"./index.d274af24.js";import{G as p}from"./index.03b5aaf0.js";import{A as O}from"./AddIgnoredUser.generated.2c291645.js";import{D as $}from"./DeleteIgnoredUser.generated.f6bd9811.js";import{n as h}from"./index.bd6c5768.js";import{c as P}from"./currencies.bbaf1c4b.js";import{a as S}from"./index.9cf5ab9b.js";import{i as s}from"./index.b135e261.js";import{c as z}from"./index.922d4a37.js";import{u as w}from"./index.bda872f9.js";import{m as f}from"./utils.09bf360d.js";import{f as v}from"./loadHelpers.abbaab45.js";import{c as W}from"./create.0055b1ad.js";import{p as G}from"./stores.53eae6ef.js";const J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"PublicChats"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"publicChats"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"isPublic"}}]}}]}}]},R={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ChatMessage"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"data"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessageDataRace"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"race"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"startTime"}},{kind:"Field",name:{kind:"Name",value:"leaderboard"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"IntValue",value:"10"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RacePosition"}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessageDataTrivia"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"question"}},{kind:"Field",name:{kind:"Name",value:"answer"}},{kind:"Field",name:{kind:"Name",value:"currency"}},{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"winner"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"UserTags"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessageDataText"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"message"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessageDataBot"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"message"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessageDataTip"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tip"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"}},{kind:"Field",alias:{kind:"Name",value:"sender"},name:{kind:"Name",value:"sendBy"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"UserTags"}}]}},{kind:"Field",alias:{kind:"Name",value:"receiver"},name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"UserTags"}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatMessageDataRain"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"rain"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"}},{kind:"Field",name:{kind:"Name",value:"rainUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}}]}}]}},{kind:"Field",alias:{kind:"Name",value:"giver"},name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"UserTags"}}]}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"createdAt"}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"UserTags"}}]}}]}},..._.definitions,...V.definitions]},Y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"MessageList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chatId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chatId"},value:{kind:"Variable",name:{kind:"Name",value:"chatId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"messageList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"limit"},value:{kind:"IntValue",value:"30"}},{kind:"Argument",name:{kind:"Name",value:"offset"},value:{kind:"IntValue",value:"0"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ChatMessage"}}]}}]}}]}},...R.definitions]},H={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ChatMessages"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chatId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chatMessages"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chatId"},value:{kind:"Variable",name:{kind:"Name",value:"chatId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ChatMessage"}}]}}]}},...R.definitions]},K={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"SendMessage"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"chatId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sendMessage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"chatId"},value:{kind:"Variable",name:{kind:"Name",value:"chatId"}}},{kind:"Argument",name:{kind:"Name",value:"message"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"slashCommandsUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}}]}}]}}]},X=d(!1),Q=d("question"),bn=d(p(S)),wn=d(""),yn=d(""),Z=d(""),ee=d(null),ne=d(null),ae=(e,n)=>e&&e.toLowerCase()===n.toLowerCase(),Un=(e,n)=>{var t,o;const a=new Date(e.createdAt),i=((t=e==null?void 0:e.data)==null?void 0:t.__typename)==="ChatMessageDataText"?e.data.message:"";a.getTime()>p(ee).getTime()&&ae(i,p(Z))&&((o=e==null?void 0:e.user)==null?void 0:o.id)!==n.id&&(ne.set(e),Q.set("credited"))},N={twitterAlt:s._("Share to Twitter"),viewBet:s._("View bet"),viewGame:s._("View game"),viewCasinoBet:s._("Lookup casino bet"),viewSportBet:s._("Lookup sport bet"),viewUser:s._("View user"),tipUser:s._("Tip user"),trivia:s._("Trivia"),makeRain:s._("Make it Rain"),ignoreUser:s._("Ignore user"),unignoreUser:s._("Unignore user"),adminPanel:s._("Admin panel"),userNotFound:s._("User not found")},ie={...N,viewBet:s._("View game")},te={stake:N,sweeps:ie},u=te[z]||N,se=""+new URL("../assets/adesanya.96792bf6.png",import.meta.url).href,oe=""+new URL("../assets/beer.675cabe0.png",import.meta.url).href,re=""+new URL("../assets/biden.5399ef62.png",import.meta.url).href,de=""+new URL("../assets/blob.6c18f6ab.gif",import.meta.url).href,me=""+new URL("../assets/catbread.8386b741.gif",import.meta.url).href,le=""+new URL("../assets/coffee.c1b8200f.png",import.meta.url).href,ce=""+new URL("../assets/coin.cb7891ca.gif",import.meta.url).href,ue=""+new URL("../assets/cooldoge.f0e5bfc7.png",import.meta.url).href,ke=""+new URL("../assets/coupon.81e21d40.png",import.meta.url).href,pe=""+new URL("../assets/dendi.c74bc25b.png",import.meta.url).href,ge=""+new URL("../assets/djokovic.1db7ddf6.png",import.meta.url).href,fe=""+new URL("../assets/doge.4acb0326.png",import.meta.url).href,ve=""+new URL("../assets/donut.0c86ddce.png",import.meta.url).href,he=""+new URL("../assets/easyms.537bddcf.png",import.meta.url).href,Se=""+new URL("../assets/eddie.d2d5dd96.png",import.meta.url).href,Ne=""+new URL("../assets/ezpz.3dc2b8b4.png",import.meta.url).href,be=""+new URL("../assets/gary.b9016af8.png",import.meta.url).href,we=""+new URL("../assets/jordan.e848c7fa.png",import.meta.url).href,ye=""+new URL("../assets/kanye.8e175f1f.png",import.meta.url).href,Ue=""+new URL("../assets/lambo.239ef6f3.png",import.meta.url).href,Le=""+new URL("../assets/lebron.1b382fb4.png",import.meta.url).href,Fe=""+new URL("../assets/lefroge.29eb45cd.png",import.meta.url).href,Re=""+new URL("../assets/mahomes.bb90f768.png",import.meta.url).href,Ce=""+new URL("../assets/mcgregor.e3a51068.png",import.meta.url).href,De=""+new URL("../assets/messi.8f7ab838.png",import.meta.url).href,Te=""+new URL("../assets/nadal.e34670d9.png",import.meta.url).href,Ie=""+new URL("../assets/nightdoge.b8b285f1.png",import.meta.url).href,_e=""+new URL("../assets/nyancat.10d469a6.gif",import.meta.url).href,Ve=""+new URL("../assets/pepe.17a128a2.png",import.meta.url).href,Me=""+new URL("../assets/pikachu.2867e9c2.png",import.meta.url).href,je=""+new URL("../assets/rigged.6f4aad41.png",import.meta.url).href,Ae=""+new URL("../assets/rish.b7f077b2.png",import.meta.url).href,Ee=""+new URL("../assets/ronaldo.b7769c52.png",import.meta.url).href,xe=""+new URL("../assets/santa.688bde25.png",import.meta.url).href,Be=""+new URL("../assets/skem.c930d720.png",import.meta.url).href,qe=""+new URL("../assets/stonks.17fc06a0.png",import.meta.url).href,Oe=""+new URL("../assets/trump.30a20c5e.png",import.meta.url).href,$e=""+new URL("../assets/umbrella.55f71a21.png",import.meta.url).href,Pe=""+new URL("../assets/sus.2de0c0ee.png",import.meta.url).href,ze=""+new URL("../assets/woods.118266e9.png",import.meta.url).href,We=""+new URL("../assets/elon.c1debee3.png",import.meta.url).href,Ge=""+new URL("../assets/feelsgoodman.e4e32537.png",import.meta.url).href,Je=""+new URL("../assets/monkas.2f6e3e9e.png",import.meta.url).href,Ye=""+new URL("../assets/pepehands.d13947be.png",import.meta.url).href,He=""+new URL("../assets/poggers.db0af998.png",import.meta.url).href,Ke={adesanya:se,biden:re,beer:oe,blob:de,catbread:me,coffee:le,cooldoge:ue,coupon:ke,coin:ce,dendi:pe,djokovic:ge,doge:fe,donut:ve,easymoney:he,eddie:Se,ezpz:Ne,gary:be,jordan:we,kanye:ye,lambo:Ue,lebron:Le,lefroge:Fe,mahomes:Re,mcgregor:Ce,messi:De,nadal:Te,nightdoge:Ie,nyancat:_e,pepe:Ve,pikachu:Me,rigged:je,rish:Ae,ronaldo:Ee,santa:xe,skem:Be,stonks:qe,sus:Pe,trump:Oe,umbrella:$e,woods:ze,elon:We,feelsgoodman:Ge,monkas:Je,pepehands:Ye,poggers:He},Xe=Object.keys(Ke).map(e=>`:${e}:`).sort(),Qe=[{cmd:"/bet",icon:"emoji-stats",desc:"View bet",message:u.viewBet,syntax:"[bet id]",action:(...e)=>{const n=e.join();n.length&&f.bet.open({iid:n})}},{cmd:"/casino",icon:"emoji-stats",desc:"View casino bet",message:u.viewCasinoBet,syntax:"[bet id]",hidden:!0,action:e=>{const n=`house:${e.replace(/\D/g,"")}`;n.length&&f.bet.open({iid:n})}},{cmd:"/sport",icon:"emoji-stats",desc:"View sport bet",message:u.viewSportBet,syntax:"[bet id]",hidden:!0,action:e=>{const n=`sport:${e.replace(/\D/g,"")}`;n.length&&f.bet.open({iid:n})}},{cmd:"/user",icon:"emoji-user",desc:"View user",message:u.viewUser,syntax:"@user",action:e=>{f.user.open({name:e})}},{cmd:"/tip",icon:"emoji-tip",desc:"Tip user",message:u.tipUser,syntax:"@user",action:e=>f.wallet.open({tab:"tip",currency:p(S),name:typeof e=="string"?e:""})},{cmd:"/trivia",icon:"trivia",desc:"Trivia",message:u.trivia,admin:!0,action:()=>{X.set(!0)}},{cmd:"/rain",icon:"emoji-rain",desc:"Make it Rain",message:u.makeRain,action:()=>{f.rain.open({currency:P[p(S)]})}},{cmd:"/ignore",icon:"emoji-ignore",desc:"Ignore user",message:u.ignoreUser,syntax:"@user",action:async e=>{if(!e)h.userNotFound.open();else{const n=await v({load:{fetch},doc:y,variables:{name:e}}),a=n==null?void 0:n.user;if(!a)h.userNotFound.open();else{const i=await v({load:{fetch},doc:O,variables:{userId:a.id}});i!=null&&i.addIgnoredUser&&h.userIgnored.open()}}}},{cmd:"/unignore",icon:"emoji-unignore",desc:"Unignore user",message:u.unignoreUser,syntax:"@user",action:async e=>{if(!e)h.userNotFound.open();else{const n=await v({load:{fetch},doc:y,variables:{name:e}}),a=n==null?void 0:n.user;a?await v({load:{fetch},doc:$,variables:{userId:a.id}}):h.userNotFound.open()}}},{cmd:"/admin",icon:"gear",desc:"Admin panel",message:u.adminPanel,syntax:"@user",admin:!0,action:e=>{f.moderation.open({name:e})}},{cmd:"/unsichtbar",hidden:!0,action:()=>{w.set(!0)}},{cmd:"/sichtbar",hidden:!0,action:()=>{w.set(!1)}}].filter(Boolean),Ze=(e,n,a)=>Qe.filter(i=>(i.admin?n:!0)&&i.cmd.toLowerCase().includes(e.toLowerCase())&&(a?!0:!i.hidden)),Ln=e=>e.substring(e.length-1)===" "?!1:e.length===1&&e.includes(":")?!0:m.last(e.split(" ")).includes(":"),Fn=e=>e.substring(e.length-1)===" "?!1:e.length===1&&e.includes("@")?!0:m.last(e.split(" ")).includes("@"),Rn=e=>e.ref?m.last(`${e.message}`.slice(0,e.ref.selectionStart).split("@")).replace("@","").toLowerCase():"",Cn=e=>e.ref?m.last(`${e.message}`.slice(0,e.ref.selectionStart).split(":")).replace(":","").toLowerCase():"",Dn=e=>{const n=Xe.filter(a=>a.toLowerCase().includes(e.toLowerCase()));return m.uniq(n).map(a=>({emoji:a}))},Tn=(e,n)=>{const a=[...n].map(i=>i.name).filter(i=>i.toLowerCase().includes(e.toLowerCase()));return e.length>0&&a.push(e),m.uniq(a).map(i=>({name:i}))},In=(e,{emoji:n})=>{const a=m.last(e.message.split(":"));return`${e.message.substring(0,e.message.length-a.length-1)}${n} `},_n=(e,{name:n})=>{const a=m.last(e.message.split("@"));return`${e.message.substring(0,e.message.length-a.length)}${n} `},C=W(),Vn=e=>C.subscribe(n=>{const a=n.type in e?e[n.type]:void 0;a&&a(n)}),b=(()=>d(null))(),Mn=M(!1),D=L([G],([e])=>{var n;return((n=e==null?void 0:e.data)==null?void 0:n.chatListQuery)||null}),jn=e=>v({doc:J,load:e,variables:{}}),An=L([D,b],([e,n])=>e==null?void 0:e.publicChats.find(a=>a.id===n)),En=e=>(()=>{const n=d({loading:!1,messageList:[]}),a=i=>{n.update(t=>({...t,messageList:m.uniqBy([...t.messageList.slice(-50),i],"id")})),U.update(t=>m.uniqBy([...t,i.user],"id"))};return{...n,addMessage:a,fetch:({chatId:i,urqlId:t,onCompleted:o})=>{let r=!1;const k=F();return n.set({loading:!0,messageList:[]}),v({doc:Y,variables:{chatId:i},load:e}).then(l=>{var c;r=!0;const g=[...((c=l==null?void 0:l.chat)==null?void 0:c.messageList)||[]].reverse();U.update(T=>m.uniqBy([...g.map(I=>I.user),...T],"id")),n.set({loading:!1,messageList:g}),o&&o()}),A(k.subscription(H,{chatId:i}),E(l=>{var g;if(r){const c=(g=l.data)==null?void 0:g.chatMessages;c&&(a(c),C.next({type:"message",data:c}))}}))}}})(),U=d([]),xn=(()=>{const e=d({message:"",loading:!1,ref:null});return{...e,sendMessage:async n=>{const{message:a,ref:i}=p(e);if(a.trim().length>=1&&a.length<=q)if(i&&i.focus(),a[0]==="/"){const[t,...o]=a.replace("@","").split(" "),r=Ze("",n.hasRole,!0).find(({cmd:k})=>k===t);r&&(e.update(k=>({...k,message:""})),r.action(...o))}else{e.update(o=>({...o,message:"",loading:!0}));const t=F();try{(await t.mutation(K,{chatId:p(b),message:a}).toPromise()).error?e.update(r=>({...r,loading:!1,message:a})):e.update(r=>({...r,loading:!1}))}catch{e.update(r=>({...r,loading:!1,message:a}))}}}}})(),Bn=(e,n)=>{var g;const a=p(j),t=e.startsWith(a("/sports"))?B:"",o=`${t}${n}`,r=`${t}${x.en}`,k=((g=p(D))==null?void 0:g.publicChats)||[],l=k.find(({name:c})=>c===o)||k.find(({name:c})=>c===r)||k[0];l!=null&&l.id&&b.set(l.id)};export{Mn as A,Bn as B,Ke as C,bn as a,b,jn as c,Z as d,wn as e,Vn as f,Un as g,ne as h,D as i,An as j,En as k,xn as l,Fn as m,Ln as n,X as o,Rn as p,yn as q,Tn as r,Q as s,ee as t,U as u,Cn as v,Dn as w,Ze as x,In as y,_n as z};
