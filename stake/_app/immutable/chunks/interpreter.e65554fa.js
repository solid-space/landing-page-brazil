import{i as I,t as qt,g as Xt,a as j,b as O,_ as l,c as rt,p as Gt,u as he,f as _,d as J,e as Yt,h as Wt,j as Dt,k as R,l as P,n as F,o as Rt,m as Qt,E as zt,q as Zt,r as yt,s as K,v as Et,w as ce,x as Ct,I as z,y as de,z as le,A as Jt,B as ht,C as Bt,D as B,F as bt,G as ve,H as pe,J as Y,S as ye,K as Nt,L as $t,M as ge,N as me,O as we,P as xe}from"./utils.1fce2aa9.js";var b;(function(r){r.Start="xstate.start",r.Stop="xstate.stop",r.Raise="xstate.raise",r.Send="xstate.send",r.Cancel="xstate.cancel",r.NullEvent="",r.Assign="xstate.assign",r.After="xstate.after",r.DoneState="done.state",r.DoneInvoke="done.invoke",r.Log="xstate.log",r.Init="xstate.init",r.Invoke="xstate.invoke",r.ErrorExecution="error.execution",r.ErrorCommunication="error.communication",r.ErrorPlatform="error.platform",r.ErrorCustom="xstate.error",r.Update="xstate.update",r.Pure="xstate.pure",r.Choose="xstate.choose"})(b||(b={}));var q;(function(r){r.Parent="#_parent",r.Internal="#_internal"})(q||(q={}));var Pt=b.Start,Mt=b.Stop,xt=b.Raise,St=b.Send,Kt=b.Cancel,Se=b.NullEvent,te=b.Assign;b.After;b.DoneState;var jt=b.Log,Ee=b.Init,Ot=b.Invoke;b.ErrorExecution;var Vt=b.ErrorPlatform,ee=b.ErrorCustom,kt=b.Update,be=b.Choose,Ne=b.Pure,gt=j({type:Ee});function _t(r,t){return t&&t[r]||void 0}function ot(r,t){var e;if(O(r)||typeof r=="number"){var n=_t(r,t);I(n)?e={type:r,exec:n}:n?e=n:e={type:r,exec:void 0}}else if(I(r))e={type:r.name||r.toString(),exec:r};else{var n=_t(r.type,t);if(I(n))e=l(l({},r),{exec:n});else if(n){var a=n.type||r.type;e=l(l(l({},n),r),{type:a})}else e=r}return Object.defineProperty(e,"toString",{value:function(){return e.type},enumerable:!1,configurable:!0}),e}var mt=function(r,t){if(!r)return[];var e=Dt(r)?r:[r];return e.map(function(n){return ot(n,t)})};function Ft(r){var t=ot(r);return l(l({id:O(r)?r:t.id},t),{type:t.type})}function Te(r){return O(r)?{type:xt,event:r}:ut(r,{to:q.Internal})}function Pe(r){return{type:xt,_event:j(r.event)}}function ut(r,t){return{to:t?t.to:void 0,type:St,event:I(r)?r:qt(r),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:I(r)?r.name:Xt(r)}}function Oe(r,t,e,n){var a={_event:e},i=j(I(r.event)?r.event(t,e.data,a):r.event),s;if(O(r.delay)){var f=n&&n[r.delay];s=I(f)?f(t,e.data,a):f}else s=I(r.delay)?r.delay(t,e.data,a):r.delay;var o=I(r.to)?r.to(t,e.data,a):r.to;return l(l({},r),{to:o,_event:i,event:i.data,delay:s})}function re(r,t){return ut(r,l(l({},t),{to:q.Parent}))}function er(){return re(kt)}function rr(r,t){return ut(r,l(l({},t),{to:function(e,n,a){var i=a._event;return i.origin}}))}var _e=function(r,t){return{context:r,event:t}};function nr(r,t){return r===void 0&&(r=_e),{type:jt,label:t,expr:r}}var Ie=function(r,t,e){return l(l({},r),{value:O(r.expr)?r.expr:r.expr(t,e.data,{_event:e})})},Le=function(r){return{type:Kt,sendId:r}};function Ae(r){var t=Ft(r);return{type:b.Start,activity:t,exec:void 0}}function De(r){var t=I(r)?r:Ft(r);return{type:b.Stop,activity:t,exec:void 0}}function Re(r,t,e){var n=I(r.activity)?r.activity(t,e.data):r.activity,a=typeof n=="string"?{id:n}:n,i={type:b.Stop,activity:a};return i}var ir=function(r){return{type:te,assignment:r}};function Me(r,t){var e=t?"#"+t:"";return b.After+"("+r+")"+e}function ct(r,t){var e=b.DoneState+"."+r,n={type:e,data:t};return n.toString=function(){return e},n}function vt(r,t){var e=b.DoneInvoke+"."+r,n={type:e,data:t};return n.toString=function(){return e},n}function nt(r,t){var e=b.ErrorPlatform+"."+r,n={type:e,data:t};return n.toString=function(){return e},n}function ar(r){return{type:b.Pure,get:r}}function sr(r,t){return ut(function(e,n){return n},l(l({},t),{to:r}))}function or(r,t){return re(function(e,n,a){return{type:ee,data:I(r)?r(e,n,a):r}},l(l({},t),{to:q.Parent}))}function ur(r){return{type:b.Choose,conds:r}}function It(r,t,e,n,a){var i=rt(Gt(a,function(u){return u.type===te}),2),s=i[0],f=i[1],o=s.length?he(e,n,s,t):e,c=_(f.map(function(u){var d;switch(u.type){case xt:return Pe(u);case St:var h=Oe(u,o,n,r.options.delays);return h;case jt:return Ie(u,o,n);case be:{var v=u,y=(d=v.conds.find(function(g){var x=Yt(g.cond,r.options.guards);return!x||Wt(r,x,o,n,t)}))===null||d===void 0?void 0:d.actions;if(!y)return[];var m=It(r,t,o,n,mt(J(y),r.options.actions));return o=m[1],m[0]}case Ne:{var y=u.get(o,n.data);if(!y)return[];var m=It(r,t,o,n,mt(J(y),r.options.actions));return o=m[1],m[0]}case Mt:return Re(u,o,n);default:return ot(u,r.options.actions)}}));return[c,o]}var wt=function(r){return r.type==="atomic"||r.type==="final"};function tt(r){return R(r.states).map(function(t){return r.states[t]})}function ne(r){var t=[r];return wt(r)?t:t.concat(_(tt(r).map(ne)))}function Z(r,t){var e,n,a,i,s,f,o,c,u=new Set(r),d=Lt(u),h=new Set(t);try{for(var v=P(h),y=v.next();!y.done;y=v.next())for(var m=y.value,g=m.parent;g&&!h.has(g);)h.add(g),g=g.parent}catch(N){e={error:N}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(e)throw e.error}}var x=Lt(h);try{for(var p=P(h),S=p.next();!S.done;S=p.next()){var m=S.value;if(m.type==="compound"&&(!x.get(m)||!x.get(m).length))d.get(m)?d.get(m).forEach(function(A){return h.add(A)}):m.initialStateNodes.forEach(function(A){return h.add(A)});else if(m.type==="parallel")try{for(var L=(s=void 0,P(tt(m))),T=L.next();!T.done;T=L.next()){var D=T.value;D.type!=="history"&&(h.has(D)||(h.add(D),d.get(D)?d.get(D).forEach(function(A){return h.add(A)}):D.initialStateNodes.forEach(function(A){return h.add(A)})))}}catch(A){s={error:A}}finally{try{T&&!T.done&&(f=L.return)&&f.call(L)}finally{if(s)throw s.error}}}}catch(N){a={error:N}}finally{try{S&&!S.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}try{for(var E=P(h),w=E.next();!w.done;w=E.next())for(var m=w.value,g=m.parent;g&&!h.has(g);)h.add(g),g=g.parent}catch(N){o={error:N}}finally{try{w&&!w.done&&(c=E.return)&&c.call(E)}finally{if(o)throw o.error}}return h}function ie(r,t){var e=t.get(r);if(!e)return{};if(r.type==="compound"){var n=e[0];if(n){if(wt(n))return n.key}else return{}}var a={};return e.forEach(function(i){a[i.key]=ie(i,t)}),a}function Lt(r){var t,e,n=new Map;try{for(var a=P(r),i=a.next();!i.done;i=a.next()){var s=i.value;n.has(s)||n.set(s,[]),s.parent&&(n.has(s.parent)||n.set(s.parent,[]),n.get(s.parent).push(s))}}catch(f){t={error:f}}finally{try{i&&!i.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return n}function je(r,t){var e=Z([r],t);return ie(r,Lt(e))}function pt(r,t){return Array.isArray(r)?r.some(function(e){return e===t}):r instanceof Set?r.has(t):!1}function ke(r){return _(F(new Set(r.map(function(t){return t.ownEvents}))))}function st(r,t){return t.type==="compound"?tt(t).some(function(e){return e.type==="final"&&pt(r,e)}):t.type==="parallel"?tt(t).every(function(e){return st(r,e)}):!1}function ae(r,t){if(r===t)return!0;if(r===void 0||t===void 0)return!1;if(O(r)||O(t))return r===t;var e=R(r),n=R(t);return e.length===n.length&&e.every(function(a){return ae(r[a],t[a])})}function Fe(r){return O(r)?!1:"value"in r&&"history"in r}function Ue(r,t){var e=r.exec,n=l(l({},r),{exec:e!==void 0?function(){return e(t.context,t.event,{action:r,state:t,_event:t._event})}:void 0});return n}var H=function(){function r(t){var e=this;this.actions=[],this.activities=zt,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||zt,this.meta=t.meta||{},this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,Object.defineProperty(this,"nextEvents",{get:function(){return ke(e.configuration)}})}return r.from=function(t,e){if(t instanceof r)return t.context!==e?new r({value:t.value,context:e,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var n=gt;return new r({value:t,context:e,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},r.create=function(t){return new r(t)},r.inert=function(t,e){if(t instanceof r){if(!t.actions.length)return t;var n=gt;return new r({value:t.value,context:e,_event:n,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return r.from(t,e)},r.prototype.toStrings=function(t,e){var n=this;if(t===void 0&&(t=this.value),e===void 0&&(e="."),O(t))return[t];var a=R(t);return a.concat.apply(a,F(a.map(function(i){return n.toStrings(t[i],e).map(function(s){return i+e+s})})))},r.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var e=Rt(t,["configuration","transitions"]);return e},r.prototype.matches=function(t){return Qt(t,this.value)},r}(),it=function(r,t){var e=t(r);return e};function se(r){return{id:r,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},toJSON:function(){return{id:r}}}}function ze(r,t,e,n){var a,i=Zt(r.src),s=(a=t==null?void 0:t.options.services)===null||a===void 0?void 0:a[i.type],f=r.data?yt(r.data,e,n):void 0,o=s?Ce(s,r.id,f):se(r.id);return o.meta=r,o}function Ce(r,t,e){var n=se(t);return n.deferred=!0,K(r)&&(n.state=it(void 0,function(){return(e?r.withContext(e):r).initialState})),n}function Je(r){try{return typeof r.send=="function"}catch{return!1}}function Be(r){return Je(r)&&"id"in r}function $e(r){if(typeof r=="string"){var t={type:r};return t.toString=function(){return r},t}return r}function dt(r){return l(l({type:Ot},r),{toJSON:function(){r.onDone,r.onError;var t=Rt(r,["onDone","onError"]);return l(l({},t),{type:Ot,src:$e(r.src)})}})}var at="",At="#",et="*",W={},Q=function(r){return r[0]===At},Ve=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},He=function(r,t,e){var n=e.slice(0,-1).some(function(i){return!("cond"in i)&&!("in"in i)&&(O(i.target)||K(i.target))}),a=t===at?"the transient event":"event '"+t+"'";B(!n,"One or more transitions for "+a+" on state '"+r.id+"' are unreachable. Make sure that the default transition is the last one defined.")},qe=function(){function r(t,e,n){var a=this;n===void 0&&(n=void 0);var i;this.config=t,this.context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.options=Object.assign(Ve(),e),this.parent=this.options._parent,this.key=this.config.key||this.options._key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:ye),this.id=this.config.id||F([this.machine.key],this.path).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&R(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(i=this.config.schema)!==null&&i!==void 0?i:{},this.initial=this.config.initial,this.states=this.config.states?ht(this.config.states,function(o,c){var u,d=new r(o,{_parent:a,_key:c});return Object.assign(a.idMap,l((u={},u[d.id]=d,u),d.idMap)),d}):W;var s=0;function f(o){var c,u;o.order=s++;try{for(var d=P(tt(o)),h=d.next();!h.done;h=d.next()){var v=h.value;f(v)}}catch(y){c={error:y}}finally{try{h&&!h.done&&(u=d.return)&&u.call(d)}finally{if(c)throw c.error}}}f(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(o){var c=o.event;return c===at}):at in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=J(this.config.entry||this.config.onEntry).map(function(o){return ot(o)}),this.onExit=J(this.config.exit||this.config.onExit).map(function(o){return ot(o)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=J(this.config.invoke).map(function(o,c){var u,d;if(K(o))return a.machine.options.services=l((u={},u[o.id]=o,u),a.machine.options.services),dt({src:o.id,id:o.id});if(O(o.src))return dt(l(l({},o),{id:o.id||o.src,src:o.src}));if(K(o.src)||I(o.src)){var h=a.id+":invocation["+c+"]";return a.machine.options.services=l((d={},d[h]=o.src,d),a.machine.options.services),dt(l(l({id:h},o),{src:h}))}else{var v=o.src;return dt(l(l({id:v.type},o),{src:v}))}}),this.activities=J(this.config.activities).concat(this.invoke).map(function(o){return Ft(o)}),this.transition=this.transition.bind(this)}return r.prototype._init=function(){this.__cache.transitions||ne(this).forEach(function(t){return t.on})},r.prototype.withConfig=function(t,e){e===void 0&&(e=this.context);var n=this.options,a=n.actions,i=n.activities,s=n.guards,f=n.services,o=n.delays;return new r(this.config,{actions:l(l({},a),t.actions),activities:l(l({},i),t.activities),guards:l(l({},s),t.guards),services:l(l({},f),t.services),delays:l(l({},o),t.delays)},e)},r.prototype.withContext=function(t){return new r(this.config,this.options,t)},Object.defineProperty(r.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ht(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke}},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return this.definition},Object.defineProperty(r.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(e,n){return e[n.eventType]=e[n.eventType]||[],e[n.eventType].push(n),e},{})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),r.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=t===at,n=this.transitions.filter(function(a){var i=a.eventType===t;return e?i:i||a.eventType===et});return this.__cache.candidates[t]=n,n},r.prototype.getDelayedTransitions=function(){var t=this,e=this.config.after;if(!e)return[];var n=function(i,s){var f=I(i)?t.id+":delay["+s+"]":i,o=Me(f,t.id);return t.onEntry.push(ut(o,{delay:i})),t.onExit.push(Le(o)),o},a=Dt(e)?e.map(function(i,s){var f=n(i.delay,s);return l(l({},i),{event:f})}):_(R(e).map(function(i,s){var f=e[i],o=O(f)?{target:f}:f,c=isNaN(+i)?i:+i,u=n(c,s);return J(o).map(function(d){return l(l({},d),{event:u,delay:c})})}));return a.map(function(i){var s=i.delay;return l(l({},t.formatTransition(i)),{delay:s})})},r.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var a=t instanceof H?t.value:Et(t,this.delimiter);if(O(a)){var i=this.getStateNode(a).initial;return i!==void 0?this.getStateNodes((e={},e[a]=i,e)):[this.states[a]]}var s=R(a),f=s.map(function(o){return n.getStateNode(o)});return f.concat(s.reduce(function(o,c){var u=n.getStateNode(c).getStateNodes(a[c]);return o.concat(u)},[]))},r.prototype.handles=function(t){var e=Xt(t);return this.events.includes(e)},r.prototype.resolveState=function(t){var e=Array.from(Z([],this.getStateNodes(t.value)));return new H(l(l({},t),{value:this.resolve(t.value),configuration:e,done:st(e,this)}))},r.prototype.transitionLeafNode=function(t,e,n){var a=this.getStateNode(t),i=a.next(e,n);return!i||!i.transitions.length?this.next(e,n):i},r.prototype.transitionCompoundNode=function(t,e,n){var a=R(t),i=this.getStateNode(a[0]),s=i._transition(t[a[0]],e,n);return!s||!s.transitions.length?this.next(e,n):s},r.prototype.transitionParallelNode=function(t,e,n){var a,i,s={};try{for(var f=P(R(t)),o=f.next();!o.done;o=f.next()){var c=o.value,u=t[c];if(u){var d=this.getStateNode(c),h=d._transition(u,e,n);h&&(s[c]=h)}}}catch(p){a={error:p}}finally{try{o&&!o.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var v=R(s).map(function(p){return s[p]}),y=_(v.map(function(p){return p.transitions})),m=v.some(function(p){return p.transitions.length>0});if(!m)return this.next(e,n);var g=_(v.map(function(p){return p.entrySet})),x=_(R(s).map(function(p){return s[p].configuration}));return{transitions:y,entrySet:g,exitSet:_(v.map(function(p){return p.exitSet})),configuration:x,source:e,actions:_(R(s).map(function(p){return s[p].actions}))}},r.prototype._transition=function(t,e,n){return O(t)?this.transitionLeafNode(t,e,n):R(t).length===1?this.transitionCompoundNode(t,e,n):this.transitionParallelNode(t,e,n)},r.prototype.next=function(t,e){var n,a,i=this,s=e.name,f=[],o=[],c;try{for(var u=P(this.getCandidates(s)),d=u.next();!d.done;d=u.next()){var h=d.value,v=h.cond,y=h.in,m=t.context,g=y?O(y)&&Q(y)?t.matches(Et(this.getStateNodeById(y).path,this.delimiter)):Qt(Et(y,this.delimiter),ce(this.path.slice(0,-2))(t.value)):!0,x=!1;try{x=!v||Wt(this.machine,v,m,e,t)}catch(T){throw new Error("Unable to evaluate guard '"+(v.name||v.type)+"' in transition for event '"+s+"' in state node '"+this.id+`':
`+T.message)}if(x&&g){h.target!==void 0&&(o=h.target),f.push.apply(f,F(h.actions)),c=h;break}}}catch(T){n={error:T}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(c){if(!o.length)return{transitions:[c],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:f};var p=_(o.map(function(T){return i.getRelativeStateNodes(T,t.historyValue)})),S=!!c.internal,L=S?[]:_(p.map(function(T){return i.nodesFromChild(T)}));return{transitions:[c],entrySet:L,exitSet:S?[]:[this],configuration:p,source:t,actions:f}}},r.prototype.nodesFromChild=function(t){if(t.escapes(this))return[];for(var e=[],n=t;n&&n!==this;)e.push(n),n=n.parent;return e.push(this),e},r.prototype.escapes=function(t){if(this===t)return!1;for(var e=this.parent;e;){if(e===t)return!1;e=e.parent}return!0},r.prototype.getActions=function(t,e,n,a){var i,s,f,o,c=Z([],a?this.getStateNodes(a.value):[this]),u=t.configuration.length?Z(c,t.configuration):c;try{for(var d=P(u),h=d.next();!h.done;h=d.next()){var v=h.value;pt(c,v)||t.entrySet.push(v)}}catch(E){i={error:E}}finally{try{h&&!h.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}try{for(var y=P(c),m=y.next();!m.done;m=y.next()){var v=m.value;(!pt(u,v)||pt(t.exitSet,v.parent))&&t.exitSet.push(v)}}catch(E){f={error:E}}finally{try{m&&!m.done&&(o=y.return)&&o.call(y)}finally{if(f)throw f.error}}t.source||(t.exitSet=[],t.entrySet.push(this));var g=_(t.entrySet.map(function(E){var w=[];if(E.type!=="final")return w;var N=E.parent;if(!N.parent)return w;w.push(ct(E.id,E.doneData),ct(N.id,E.doneData?yt(E.doneData,e,n):void 0));var A=N.parent;return A.type==="parallel"&&tt(A).every(function($){return st(t.configuration,$)})&&w.push(ct(A.id)),w}));t.exitSet.sort(function(E,w){return w.order-E.order}),t.entrySet.sort(function(E,w){return E.order-w.order});var x=new Set(t.entrySet),p=new Set(t.exitSet),S=rt([_(Array.from(x).map(function(E){return F(E.activities.map(function(w){return Ae(w)}),E.onEntry)})).concat(g.map(Te)),_(Array.from(p).map(function(E){return F(E.onExit,E.activities.map(function(w){return De(w)}))}))],2),L=S[0],T=S[1],D=mt(T.concat(t.actions).concat(L),this.machine.options.actions);return D},r.prototype.transition=function(t,e,n){t===void 0&&(t=this.initialState);var a=j(e),i;if(t instanceof H)i=n===void 0?t:this.resolveState(H.from(t,n));else{var s=O(t)?this.resolve(Ct(this.getResolvedPath(t))):this.resolve(t),f=n||this.machine.context;i=this.resolveState(H.from(s,f))}if(!z&&a.name===et)throw new Error("An event cannot have the wildcard type ('"+et+"')");if(this.strict&&!this.events.includes(a.name)&&!de(a.name))throw new Error("Machine '"+this.id+"' does not accept event '"+a.name+"'");var o=this._transition(i.value,i,a)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:i,actions:[]},c=Z([],this.getStateNodes(i.value)),u=o.configuration.length?Z(c,o.configuration):c;return o.configuration=F(u),this.resolveTransition(o,i,a)},r.prototype.resolveRaisedTransition=function(t,e,n){var a,i=t.actions;return t=this.transition(t,e),t._event=n,t.event=n.data,(a=t.actions).unshift.apply(a,F(i)),t},r.prototype.resolveTransition=function(t,e,n,a){var i,s,f=this;n===void 0&&(n=gt),a===void 0&&(a=this.machine.context);var o=t.configuration,c=!e||t.transitions.length>0,u=c?je(this.machine,o):void 0,d=e?e.historyValue?e.historyValue:t.source?this.machine.historyValue(e.value):void 0:void 0,h=e?e.context:a,v=this.getActions(t,h,n,e),y=e?l({},e.activities):{};try{for(var m=P(v),g=m.next();!g.done;g=m.next()){var x=g.value;x.type===Pt?y[x.activity.id||x.activity.type]=x:x.type===Mt&&(y[x.activity.id||x.activity.type]=!1)}}catch(M){i={error:M}}finally{try{g&&!g.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}var p=rt(It(this,e,h,n,v),2),S=p[0],L=p[1],T=rt(Gt(S,function(M){return M.type===xt||M.type===St&&M.to===q.Internal}),2),D=T[0],E=T[1],w=S.filter(function(M){var C;return M.type===Pt&&((C=M.activity)===null||C===void 0?void 0:C.type)===Ot}),N=w.reduce(function(M,C){return M[C.activity.id]=ze(C.activity,f.machine,L,n),M},e?l({},e.children):{}),A=u?t.configuration:e?e.configuration:[],$=A.reduce(function(M,C){return C.meta!==void 0&&(M[C.id]=C.meta),M},{}),V=st(A,this),X=new H({value:u||e.value,context:L,_event:n,_sessionid:e?e._sessionid:null,historyValue:u?d?le(d,u):void 0:e?e.historyValue:void 0,history:!u||t.source?e:void 0,actions:u?E:[],activities:u?y:e?e.activities:{},meta:u?$:e?e.meta:void 0,events:[],configuration:A,transitions:t.transitions,children:N,done:V}),ft=h!==L;X.changed=n.name===kt||ft;var G=X.history;if(G&&delete G.history,!u)return X;var U=X;if(!V){var oe=this._transient||o.some(function(M){return M._transient});for(oe&&(U=this.resolveRaisedTransition(U,{type:Se},n));D.length;){var ue=D.shift();U=this.resolveRaisedTransition(U,ue._event,n)}}var fe=U.changed||(G?!!U.actions.length||ft||typeof G.value!=typeof U.value||!ae(U.value,G.value):void 0);return U.changed=fe,U.history=G,U},r.prototype.getStateNode=function(t){if(Q(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '"+t+"' from '"+this.id+"'; no child states exist.");var e=this.states[t];if(!e)throw new Error("Child state '"+t+"' does not exist on '"+this.id+"'");return e},r.prototype.getStateNodeById=function(t){var e=Q(t)?t.slice(At.length):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Child state node '#"+e+"' does not exist on machine '"+this.id+"'");return n},r.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&Q(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var e=Jt(t,this.delimiter).slice(),n=this;e.length;){var a=e.shift();if(!a.length)break;n=n.getStateNode(a)}return n},r.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||W;switch(this.type){case"parallel":return ht(this.initialStateValue,function(i,s){return i?n.getStateNode(s).resolve(t[s]||i):W});case"compound":if(O(t)){var a=this.getStateNode(t);return a.type==="parallel"||a.type==="compound"?(e={},e[t]=a.initialStateValue,e):t}return R(t).length?ht(t,function(i,s){return i?n.getStateNode(s).resolve(i):W}):this.initialStateValue||{};default:return t||W}},r.prototype.getResolvedPath=function(t){if(Q(t)){var e=this.machine.idMap[t.slice(At.length)];if(!e)throw new Error("Unable to find state node '"+t+"'");return e.path}return Jt(t,this.delimiter)},Object.defineProperty(r.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var e;if(this.type==="parallel")e=Bt(this.states,function(n){return n.initialStateValue||W},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '"+this.initial+"' not found on '"+this.key+"'");e=wt(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),r.prototype.getInitialState=function(t,e){var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,entrySet:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,void 0,e)},Object.defineProperty(r.prototype,"initialState",{get:function(){this._init();var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '"+this.id+"'.");return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"target",{get:function(){var t;if(this.type==="history"){var e=this.config;O(e.target)?t=Q(e.target)?Ct(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target:t=e.target}return t},enumerable:!1,configurable:!0}),r.prototype.getRelativeStateNodes=function(t,e,n){return n===void 0&&(n=!0),n?t.type==="history"?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(r.prototype,"initialStateNodes",{get:function(){var t=this;if(wt(this))return[this];if(this.type==="compound"&&!this.initial)return z||B(!1,"Compound state node '"+this.id+"' has no initial state."),[this];var e=bt(this.initialStateValue);return _(e.map(function(n){return t.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),r.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=rt(t),n=e[0],a=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '"+n+"' from node with no states");var i=this.getStateNode(n);if(i.type==="history")return i.resolveHistory();if(!this.states[n])throw new Error("Child state '"+n+"' does not exist on '"+this.id+"'");return this.states[n].getFromRelativePath(a)},r.prototype.historyValue=function(t){if(R(this.states).length)return{current:t||this.initialStateValue,states:Bt(this.states,function(e,n){if(!t)return e.historyValue();var a=O(t)?void 0:t[n];return e.historyValue(a||e.initialStateValue)},function(e){return!e.history})}},r.prototype.resolveHistory=function(t){var e=this;if(this.type!=="history")return[this];var n=this.parent;if(!t){var a=this.target;return a?_(bt(a).map(function(s){return n.getFromRelativePath(s)})):n.initialStateNodes}var i=ve(n.path,"states")(t).current;return O(i)?[n.getStateNode(i)]:_(bt(i).map(function(s){return e.history==="deep"?n.getFromRelativePath(s):[n.states[s[0]]]}))},Object.defineProperty(r.prototype,"stateIds",{get:function(){var t=this,e=_(R(this.states).map(function(n){return t.states[n].stateIds}));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"events",{get:function(){var t,e,n,a;if(this.__cache.events)return this.__cache.events;var i=this.states,s=new Set(this.ownEvents);if(i)try{for(var f=P(R(i)),o=f.next();!o.done;o=f.next()){var c=o.value,u=i[c];if(u.states)try{for(var d=(n=void 0,P(u.events)),h=d.next();!h.done;h=d.next()){var v=h.value;s.add(""+v)}}catch(y){n={error:y}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}}}catch(y){t={error:y}}finally{try{o&&!o.done&&(e=f.return)&&e.call(f)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(s)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(e){return!(!e.target&&!e.actions.length&&e.internal)}).map(function(e){return e.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),r.prototype.resolveTarget=function(t){var e=this;if(t!==void 0)return t.map(function(n){if(!O(n))return n;var a=n[0]===e.delimiter;if(a&&!e.parent)return e.getStateNodeByPath(n.slice(1));var i=a?e.key+n:n;if(e.parent)try{var s=e.parent.getStateNodeByPath(i);return s}catch(f){throw new Error("Invalid transition definition for state node '"+e.id+`':
`+f.message)}else return e.getStateNodeByPath(i)})},r.prototype.formatTransition=function(t){var e=this,n=pe(t.target),a="internal"in t?t.internal:n?n.some(function(o){return O(o)&&o[0]===e.delimiter}):!0,i=this.machine.options.guards,s=this.resolveTarget(n),f=l(l({},t),{actions:mt(J(t.actions)),cond:Yt(t.cond,i),target:s,source:this,internal:a,eventType:t.event,toJSON:function(){return l(l({},f),{target:f.target?f.target.map(function(o){return"#"+o.id}):void 0,source:"#"+e.id})}});return f},r.prototype.formatTransitions=function(){var t,e,n=this,a;if(!this.config.on)a=[];else if(Array.isArray(this.config.on))a=this.config.on;else{var i=this.config.on,s=et,f=i[s],o=f===void 0?[]:f,c=Rt(i,[typeof s=="symbol"?s:s+""]);a=_(R(c).map(function(p){!z&&p===at&&B(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+('Please check the `on` configuration for "#'+n.id+'".'));var S=Y(p,c[p]);return z||He(n,p,S),S}).concat(Y(et,o)))}var u=this.config.always?Y("",this.config.always):[],d=this.config.onDone?Y(String(ct(this.id)),this.config.onDone):[];z||B(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'+this.id+'".');var h=_(this.invoke.map(function(p){var S=[];return p.onDone&&S.push.apply(S,F(Y(String(vt(p.id)),p.onDone))),p.onError&&S.push.apply(S,F(Y(String(nt(p.id)),p.onError))),S})),v=this.after,y=_(F(d,h,a,u).map(function(p){return J(p).map(function(S){return n.formatTransition(S)})}));try{for(var m=P(v),g=m.next();!g.done;g=m.next()){var x=g.value;y.push(x)}}catch(p){t={error:p}}finally{try{g&&!g.done&&(e=m.return)&&e.call(m)}finally{if(t)throw t.error}}return y},r}();function fr(r,t,e){e===void 0&&(e=r.context);var n=typeof e=="function"?e():e;return new qe(r,t,n)}var Xe={deferEvents:!1},Ht=function(){function r(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=l(l({},Xe),t)}return r.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},r.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},r.prototype.clear=function(){this.queue=[]},r.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},r.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(e){throw this.clear(),e}finally{this.processingEvent=!1}},r}(),Tt=new Map,Ge=0,lt={bookId:function(){return"x:"+Ge++},register:function(r,t){return Tt.set(r,t),r},get:function(r){return Tt.get(r)},free:function(r){Tt.delete(r)}};function Ut(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Ye(){var r=Ut();if(r&&"__xstate__"in r)return r.__xstate__}function We(r){if(!(z||!Ut())){var t=Ye();t&&t.register(r)}}var Qe={sync:!1,autoForward:!1},k;(function(r){r[r.NotStarted=0]="NotStarted",r[r.Running=1]="Running",r[r.Stopped=2]="Stopped"})(k||(k={}));var Ze=function(){function r(t,e){var n=this;e===void 0&&(e=r.defaultOptions),this.machine=t,this.scheduler=new Ht,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=k.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(u,d){if(Dt(u))return n.batch(u),n.state;var h=j(qt(u,d));if(n.status===k.Stopped)return n.state;if(n.status!==k.Running&&!n.options.deferEvents)throw new Error('Event "'+h.name+'" was sent to uninitialized service "'+n.machine.id+`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `+JSON.stringify(h.data));return n.scheduler.schedule(function(){n.forward(h);var v=n.nextState(h);n.update(v,h)}),n._state},this.sendTo=function(u,d){var h=n.parent&&(d===q.Parent||n.parent.id===d),v=h?n.parent:O(d)?n.children.get(d)||lt.get(d):we(d)?d:void 0;if(!v){if(!h)throw new Error("Unable to send event to child '"+d+"' from service '"+n.id+"'.");return}"machine"in v?v.send(l(l({},u),{name:u.name===ee?""+nt(n.id):u.name,origin:n.sessionId})):v.send(u.data)};var a=l(l({},r.defaultOptions),e),i=a.clock,s=a.logger,f=a.parent,o=a.id,c=o!==void 0?o:t.id;this.id=c,this.logger=s,this.clock=i,this.parent=f,this.options=a,this.scheduler=new Ht({deferEvents:this.options.deferEvents}),this.sessionId=lt.bookId()}return Object.defineProperty(r.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:it(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),r.prototype.execute=function(t,e){var n,a;try{for(var i=P(t.actions),s=i.next();!s.done;s=i.next()){var f=s.value;this.exec(f,t,e)}}catch(o){n={error:o}}finally{try{s&&!s.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}},r.prototype.update=function(t,e){var n,a,i,s,f,o,c,u,d=this;if(t._sessionid=this.sessionId,this._state=t,this.options.execute&&this.execute(this.state),this.children.forEach(function(N){d.state.children[N.id]=N}),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var h=P(this.eventListeners),v=h.next();!v.done;v=h.next()){var y=v.value;y(t.event)}}catch(N){n={error:N}}finally{try{v&&!v.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}try{for(var m=P(this.listeners),g=m.next();!g.done;g=m.next()){var y=g.value;y(t,t.event)}}catch(N){i={error:N}}finally{try{g&&!g.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}try{for(var x=P(this.contextListeners),p=x.next();!p.done;p=x.next()){var S=p.value;S(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(N){f={error:N}}finally{try{p&&!p.done&&(o=x.return)&&o.call(x)}finally{if(f)throw f.error}}var L=st(t.configuration||[],this.machine);if(this.state.configuration&&L){var T=t.configuration.find(function(N){return N.type==="final"&&N.parent===d.machine}),D=T&&T.doneData?yt(T.doneData,t.context,e):void 0;try{for(var E=P(this.doneListeners),w=E.next();!w.done;w=E.next()){var y=w.value;y(vt(this.id,D))}}catch(N){c={error:N}}finally{try{w&&!w.done&&(u=E.return)&&u.call(E)}finally{if(c)throw c.error}}this.stop()}},r.prototype.onTransition=function(t){return this.listeners.add(t),this.status===k.Running&&t(this.state,this.state.event),this},r.prototype.subscribe=function(t,e,n){var a=this;if(!t)return{unsubscribe:function(){}};var i,s=n;return typeof t=="function"?i=t:(i=t.next.bind(t),s=t.complete.bind(t)),this.listeners.add(i),this.status===k.Running&&i(this.state),s&&this.onDone(s),{unsubscribe:function(){i&&a.listeners.delete(i),s&&a.doneListeners.delete(s)}}},r.prototype.onEvent=function(t){return this.eventListeners.add(t),this},r.prototype.onSend=function(t){return this.sendListeners.add(t),this},r.prototype.onChange=function(t){return this.contextListeners.add(t),this},r.prototype.onStop=function(t){return this.stopListeners.add(t),this},r.prototype.onDone=function(t){return this.doneListeners.add(t),this},r.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},r.prototype.start=function(t){var e=this;if(this.status===k.Running)return this;lt.register(this.sessionId,this),this.initialized=!0,this.status=k.Running;var n=t===void 0?this.initialState:it(this,function(){return Fe(t)?e.machine.resolveState(t):e.machine.resolveState(H.from(t,e.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){e.update(n,gt)}),this},r.prototype.stop=function(){var t,e,n,a,i,s,f,o,c,u,d=this;try{for(var h=P(this.listeners),v=h.next();!v.done;v=h.next()){var y=v.value;this.listeners.delete(y)}}catch(w){t={error:w}}finally{try{v&&!v.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}try{for(var m=P(this.stopListeners),g=m.next();!g.done;g=m.next()){var y=g.value;y(),this.stopListeners.delete(y)}}catch(w){n={error:w}}finally{try{g&&!g.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}try{for(var x=P(this.contextListeners),p=x.next();!p.done;p=x.next()){var y=p.value;this.contextListeners.delete(y)}}catch(w){i={error:w}}finally{try{p&&!p.done&&(s=x.return)&&s.call(x)}finally{if(i)throw i.error}}try{for(var S=P(this.doneListeners),L=S.next();!L.done;L=S.next()){var y=L.value;this.doneListeners.delete(y)}}catch(w){f={error:w}}finally{try{L&&!L.done&&(o=S.return)&&o.call(S)}finally{if(f)throw f.error}}if(!this.initialized)return this;this.state.configuration.forEach(function(w){var N,A;try{for(var $=P(w.definition.exit),V=$.next();!V.done;V=$.next()){var X=V.value;d.exec(X,d.state)}}catch(ft){N={error:ft}}finally{try{V&&!V.done&&(A=$.return)&&A.call($)}finally{if(N)throw N.error}}}),this.children.forEach(function(w){I(w.stop)&&w.stop()});try{for(var T=P(R(this.delayedEventsMap)),D=T.next();!D.done;D=T.next()){var E=D.value;this.clock.clearTimeout(this.delayedEventsMap[E])}}catch(w){c={error:w}}finally{try{D&&!D.done&&(u=T.return)&&u.call(T)}finally{if(c)throw c.error}}return this.scheduler.clear(),this.initialized=!1,this.status=k.Stopped,lt.free(this.sessionId),this},r.prototype.batch=function(t){var e=this;if(this.status===k.NotStarted&&this.options.deferEvents)z||B(!1,t.length+' event(s) were sent to uninitialized service "'+this.machine.id+`" and are deferred. Make sure .start() is called for this service.
Event: `+JSON.stringify(event));else if(this.status!==k.Running)throw new Error(t.length+' event(s) were sent to uninitialized service "'+this.machine.id+'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.');this.scheduler.schedule(function(){var n,a,i=e.state,s=!1,f=[],o=function(h){var v=j(h);e.forward(v),i=it(e,function(){return e.machine.transition(i,v)}),f.push.apply(f,F(i.actions.map(function(y){return Ue(y,i)}))),s=s||!!i.changed};try{for(var c=P(t),u=c.next();!u.done;u=c.next()){var d=u.value;o(d)}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}i.changed=s,i.actions=f,e.update(i,j(t[t.length-1]))})},r.prototype.sender=function(t){return this.send.bind(this,t)},r.prototype.nextState=function(t){var e=this,n=j(t);if(n.name.indexOf(Vt)===0&&!this.state.nextEvents.some(function(i){return i.indexOf(Vt)===0}))throw n.data.data;var a=it(this,function(){return e.machine.transition(e.state,n)});return a},r.prototype.forward=function(t){var e,n;try{for(var a=P(this.forwardTo),i=a.next();!i.done;i=a.next()){var s=i.value,f=this.children.get(s);if(!f)throw new Error("Unable to forward event '"+t+"' from interpreter '"+this.id+"' to nonexistant child '"+s+"'.");f.send(t)}}catch(o){e={error:o}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}},r.prototype.defer=function(t){var e=this;this.delayedEventsMap[t.id]=this.clock.setTimeout(function(){t.to?e.sendTo(t._event,t.to):e.send(t._event)},t.delay)},r.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},r.prototype.exec=function(t,e,n){n===void 0&&(n=this.machine.options.actions);var a=e.context,i=e._event,s=t.exec||_t(t.type,n),f=I(s)?s:s?s.exec:t.exec;if(f)try{return f(a,i.data,{action:t,state:this.state,_event:i})}catch(S){throw this.parent&&this.parent.send({type:"xstate.error",data:S}),S}switch(t.type){case St:var o=t;if(typeof o.delay=="number"){this.defer(o);return}else o.to?this.sendTo(o._event,o.to):this.send(o._event);break;case Kt:this.cancel(t.sendId);break;case Pt:{var c=t.activity;if(!this.state.activities[c.id||c.type])break;if(c.type===b.Invoke){var u=Zt(c.src),d=this.machine.options.services?this.machine.options.services[u.type]:void 0,h=c.id,v=c.data;z||B(!("forward"in c),"`forward` property is deprecated (found in invocation of '"+c.src+"' in in machine '"+this.machine.id+"'). Please use `autoForward` instead.");var y="autoForward"in c?c.autoForward:!!c.forward;if(!d){z||B(!1,"No service found for invocation '"+c.src+"' in machine '"+this.machine.id+"'.");return}var m=v?yt(v,a,i):void 0,g=I(d)?d(a,i.data,{data:m,src:u}):d;Nt(g)?this.spawnPromise(Promise.resolve(g),h):I(g)?this.spawnCallback(g,h):$t(g)?this.spawnObservable(g,h):K(g)&&this.spawnMachine(m?g.withContext(m):g,{id:h,autoForward:y})}else this.spawnActivity(c);break}case Mt:{this.stopChild(t.activity.id);break}case jt:var x=t.label,p=t.value;x?this.logger(x,p):this.logger(p);break;default:z||B(!1,"No implementation found for action type '"+t.type+"'");break}},r.prototype.removeChild=function(t){this.children.delete(t),this.forwardTo.delete(t),delete this.state.children[t]},r.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),I(e.stop)&&e.stop())},r.prototype.spawn=function(t,e,n){if(Nt(t))return this.spawnPromise(Promise.resolve(t),e);if(I(t))return this.spawnCallback(t,e);if(Be(t))return this.spawnActor(t);if($t(t))return this.spawnObservable(t,e);if(K(t))return this.spawnMachine(t,l(l({},n),{id:e}));throw new Error('Unable to spawn entity "'+e+'" of type "'+typeof t+'".')},r.prototype.spawnMachine=function(t,e){var n=this;e===void 0&&(e={});var a=new r(t,l(l({},this.options),{parent:this,id:e.id||t.id})),i=l(l({},Qe),e);i.sync&&a.onTransition(function(f){n.send(kt,{state:f,id:a.id})});var s=a;return this.children.set(a.id,s),i.autoForward&&this.forwardTo.add(a.id),a.onDone(function(f){n.removeChild(a.id),n.send(j(f,{origin:a.id}))}).start(),s},r.prototype.spawnPromise=function(t,e){var n=this,a=!1;t.then(function(s){a||(n.removeChild(e),n.send(j(vt(e,s),{origin:e})))},function(s){if(!a){n.removeChild(e);var f=nt(e,s);try{n.send(j(f,{origin:e}))}catch(o){ge(s,o,e),n.devTools&&n.devTools.send(f,n.state),n.machine.strict&&n.stop()}}});var i={id:e,send:function(){},subscribe:function(s,f,o){var c=xe(s,f,o),u=!1;return t.then(function(d){u||(c.next(d),!u&&c.complete())},function(d){u||c.error(d)}),{unsubscribe:function(){return u=!0}}},stop:function(){a=!0},toJSON:function(){return{id:e}}};return this.children.set(e,i),i},r.prototype.spawnCallback=function(t,e){var n=this,a=!1,i=new Set,s=new Set,f=function(u){s.forEach(function(d){return d(u)}),!a&&n.send(j(u,{origin:e}))},o;try{o=t(f,function(u){i.add(u)})}catch(u){this.send(nt(e,u))}if(Nt(o))return this.spawnPromise(o,e);var c={id:e,send:function(u){return i.forEach(function(d){return d(u)})},subscribe:function(u){return s.add(u),{unsubscribe:function(){s.delete(u)}}},stop:function(){a=!0,I(o)&&o()},toJSON:function(){return{id:e}}};return this.children.set(e,c),c},r.prototype.spawnObservable=function(t,e){var n=this,a=t.subscribe(function(s){n.send(j(s,{origin:e}))},function(s){n.removeChild(e),n.send(j(nt(e,s),{origin:e}))},function(){n.removeChild(e),n.send(j(vt(e),{origin:e}))}),i={id:e,send:function(){},subscribe:function(s,f,o){return t.subscribe(s,f,o)},stop:function(){return a.unsubscribe()},toJSON:function(){return{id:e}}};return this.children.set(e,i),i},r.prototype.spawnActor=function(t){return this.children.set(t.id,t),t},r.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!e){z||B(!1,"No implementation found for activity '"+t.type+"'");return}var n=e(this.state.context,t);this.spawnEffect(t.id,n)},r.prototype.spawnEffect=function(t,e){this.children.set(t,{id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,toJSON:function(){return{id:t}}})},r.prototype.attachDev=function(){var t=Ut();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var e=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(l(l({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},e),{features:l({jump:!1,skip:!1},e?e.features:void 0)}),this.machine),this.devTools.init(this.state)}We(this)}},r.prototype.toJSON=function(){return{id:this.id}},r.prototype[me]=function(){return this},r.defaultOptions=function(t){return{execute:!0,deferEvents:!0,clock:{setTimeout:function(e,n){return setTimeout(e,n)},clearTimeout:function(e){return clearTimeout(e)}},logger:t.console.log.bind(console),devTools:!1}}(typeof self<"u"?self:global),r.interpret=Ke,r}();function Ke(r,t){var e=new Ze(r,t);return e}export{fr as M,ir as a,re as b,er as c,Le as d,Ae as e,De as f,Me as g,ct as h,Ke as i,rr as j,sr as k,nr as l,or as m,ur as n,ar as p,Te as r,ut as s};
